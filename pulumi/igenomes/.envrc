#!/usr/bin/env bash
# Environment configuration for iGenomes Pulumi project
# This file loads AWS credentials from 1Password

# Set 1Password account
export OP_ACCOUNT="nf-core"

# AWS Configuration
export AWS_DEFAULT_REGION="eu-west-1"  # iGenomes bucket is in Ireland

# Load AWS credentials from 1Password
# Secret: "AWS - Phil - iGenomes" in Shared vault
export AWS_ACCESS_KEY_ID=$(op item get "AWS - Phil - iGenomes" --vault "Shared" --fields "Access Key" 2>/dev/null || echo "")
export AWS_SECRET_ACCESS_KEY=$(op item get "AWS - Phil - iGenomes" --vault "Shared" --fields "Secret Key" 2>/dev/null || echo "")

# Pulumi Configuration
export PULUMI_BACKEND_URL="s3://nf-core-pulumi-state?region=eu-north-1&awssdk=v2"

# Verify credentials are loaded
if [ -z "$AWS_ACCESS_KEY_ID" ] || [ -z "$AWS_SECRET_ACCESS_KEY" ]; then
    echo "⚠️  Warning: Failed to load AWS credentials from 1Password"
    echo "   Make sure you're authenticated: eval \$(op signin)"
    echo "   And that the secret 'AWS - Phil - iGenomes' exists in the 'Shared' vault"
else
    echo "✅ AWS credentials loaded from 1Password"
    echo "   Region: $AWS_DEFAULT_REGION"
fi
